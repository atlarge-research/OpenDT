<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OpenDT Digital Twin</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>üè¢ OpenDT Digital Twin Dashboard</h1>
      <p class="sub">Real-time datacenter simulation in rolling windows ¬∑ LLM-guided topology optimization</p>
    </header>

    <!-- Controls -->
    <section class="controls">
      <div class="row">
        <button id="toggleBtn" class="btn btn-primary" onclick="toggleSystem()">‚ñ∂ Start</button>

        <div id="statusPill" class="status stopped">
          <span class="dot"></span>
          <strong>Status:</strong>
          <span id="statusText">STOPPED</span>
        </div>

        <div class="mode-switch">
          <div class="seg">
            <button id="btnModeUI" class="active" onclick="setMode('ui')">UI</button>
            <button id="btnModeJSON" onclick="setMode('json')">JSON</button>
          </div>
        </div>
      </div>

      <div class="sub" id="windowInfo" style="margin-top:10px;">
        <!-- filled live -->
      </div>
    </section>

    <!-- Metrics -->
    <section class="metrics">
      <div class="metric">
        <h3>PROCESSING</h3>
        <div id="mCycles" class="value">0</div>
        <div class="meta">Optimization Cycles</div>
      </div>

      <div class="metric">
        <h3>WORKLOAD</h3>
        <div id="mTasks" class="value">0</div>
        <div class="meta">Total Tasks</div>
      </div>

      <div class="metric">
        <h3>ENERGY</h3>
        <div id="mEnergy" class="value">‚Äî</div>
        <div class="meta">kWh Usage</div>
      </div>

      <div class="metric">
        <h3>CPU</h3>
        <div id="mCPU" class="value">‚Äî</div>
        <div class="meta">Utilization</div>
      </div>

      <div class="metric">
        <h3>RUNTIME</h3>
        <div id="mRuntime" class="value">‚Äî</div>
        <div class="meta">Simulation Time</div>
      </div>

      <div class="metric">
        <h3>TOPOLOGY</h3>
        <div id="mTopoUpdates" class="value">0</div>
        <div class="meta">Configuration Updates</div>
      </div>

      <div class="metric">
        <h3>LLM</h3>
        <div id="mLLMAction" class="value">‚Äî</div>
        <div class="meta" id="mLLMType">‚Äî</div>
      </div>
    </section>

    <!-- Detail cards -->
    <section class="section-grid">
      <!-- OpenDC Results -->
      <div class="card">
        <h3>üìà Latest OpenDC Results</h3>

        <!-- UI mode -->
        <div class="ui-only">
          <div class="kv">
            <div><span>Energy (kWh)</span><strong id="kvEnergy">‚Äî</strong></div>
            <div><span>CPU Utilization</span><strong id="kvCPU">‚Äî</strong></div>
            <div><span>Runtime (h)</span><strong id="kvRuntime">‚Äî</strong></div>
            <div><span>Max Power (W)</span><strong id="kvMaxPower">‚Äî</strong></div>
            <div><span>Status</span><span id="kvSimType" class="badge">‚Äî</span></div>
          </div>
        </div>

        <!-- JSON mode -->
        <pre class="json-only" id="simJSON">null</pre>
      </div>

      <!-- LLM Optimization -->
      <div class="card">
        <h3>ü§ñ LLM Optimization</h3>

        <!-- UI mode -->
        <div class="ui-only">
          <div class="kv">
            <div><span>Action</span><strong id="kvLLMAction">‚Äî</strong></div>
            <div><span>Reason</span><span id="kvLLMReason">‚Äî</span></div>
            <div><span>Priority</span><span id="kvLLMPriority" class="badge">‚Äî</span></div>
            <div><span>Type</span><span id="kvLLMType" class="badge">‚Äî</span></div>
          </div>

          <div class="panel">
            <div class="panel-title">Recommendations</div>
            <ul id="kvLLMRecs"><li>‚Äî</li></ul>
          </div>
        </div>

        <!-- JSON mode -->
        <pre class="json-only" id="llmJSON">null</pre>
      </div>
    </section>

    <!-- Topology -->
    <section class="card">
      <h3>üó∫Ô∏è Current Topology</h3>

      <!-- UI mode -->
      <div class="ui-only">
        <table id="topoTable">
          <thead>
            <tr>
              <th>Cluster</th>
              <th>Host</th>
              <th>Count</th>
              <th>Cores</th>
              <th>Clock (MHz)</th>
              <th>Memory (GiB)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="6">No topology</td></tr>
          </tbody>
        </table>
      </div>

      <!-- JSON mode -->
      <pre class="json-only" id="topologyJSON">null</pre>
    </section>

    <!-- Best Config (optional) -->
    <section class="card">
      <h3>üèÖ Best Configuration</h3>
      <div class="ui-only">
        <div id="bestScore" class="badge">Score: ‚Äî</div>
      </div>
      <pre class="json-only" id="bestJSON">null</pre>
    </section>
  </div>

  <script src="{{ url_for('static', filename='index.js') }}"></script>
</body>
</html>


